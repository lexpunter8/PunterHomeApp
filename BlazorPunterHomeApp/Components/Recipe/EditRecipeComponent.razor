@page "/recipe/edit/{Id:guid}"
@if (Recipedetails != null)
{
    <div class="container-xl" Margin="Margin.Is3.FromTop" Padding="Padding.Is2.FromTop">
        <Row>

            <Column Flex="Flex.JustifyContent.Center">

                <Heading Margin="Margin.Is2.FromTop" Size="HeadingSize.Is2" TextWeight="TextWeight.Bold">@Recipedetails.Name [edit]</Heading>
            </Column>

        </Row>
        <Row Margin="Margin.Is2.FromBottom">
            <Column ColumnSize="ColumnSize.Is12.OnMobile.Is4.OnDesktop">
                    <Div Class="d-flex flex-column" Style="background: #EEEAE4; box-shadow: 0px 0px 5px grey;" Padding="Padding.Is3">
                @if (Recipedetails.Ingredients?.Count > 0)
                {
                    
                        <h4 class="mb-0">Ingredients</h4>
                        <Div Class="d-flex px-3 my-3" Style="background: #D9D9D9; border-radius: 15px">
                            2 personen
                        </Div>
                        <Div Margin="Margin.Is3.FromBottom.OnMobile.Is3.FromRight.OnDesktop">
                            <ul class="list-unstyled">
                                @foreach (var details in Recipedetails.Ingredients)
                                {
                                    <li>
                                        <div class="flex m-1">
                                            <Div style="width: 100px">
                                                <strong>@(details.UnitQuantity)
                                                @details.UnitQuantityType</strong>

                                            </Div>
                                            <Span>
                                                @details.ProductName</Span>
                                        </div>
                                    </li>
                                }
                            </ul>

                            <Button Class="btn btn-primary" @onclick="ShowAddIngredient">Ingredient toevoegen</Button>

                        </Div>

                }
                else
                {
                    <h3 class="mt-3">Geen ingredienten</h3>
                    <p>Laat weten welke ingredienten nodig zijn voor dit gerecht door deze toe te voegen</p>
                    <Button Class="btn btn-primary align-self-start" @onclick="() => ShowAddIngredient()">Ingredient toe voegen</Button>
                }
                    </Div>


            </Column>

            <Column ColumnSize="ColumnSize.Is12.OnMobile.Is8.OnDesktop">
                
                    <Div Class="d-flex flex-column element-shadow-5" Padding="Padding.Is3">
                @if (Recipedetails.Steps == null || Recipedetails.Steps.Count == 0)
                {
                    <h3 class="mt-3">Nog bereidingwijze toegevoegd</h3>
                    <p>Laat weten hoe dit gerecht bereid moet worden door stappen toe te voegen</p>
                    <Button Class="btn btn-primary align-self-start" @onclick="AddNewStep">Stap toe voegen</Button>
                }
                else
                {
                    

                    @foreach(var step in Recipedetails.Steps)
                    {
                        <div style="position: relative">
                        <EditRecipeStepComponent StepNumber="@step.Order" Text="@step.Text"></EditRecipeStepComponent>
                        
                        <Div Style="position: absolute; top: 0px; right: 0px">
                            <Div Class="d-flex">
                                <button class="btn oval-button-tertiary" @onclick="() => MoveStepDown(step)">
                                    <i class="fas fa-arrow-up"></i>
                                </button>
                                <button class="btn oval-button-tertiary" @onclick="() => MoveStepUp(step)">
                                    <i class="fas fa-arrow-down"></i>
                                </button>
                                <button class="btn oval-button-tertiary" @onclick="() => EditStep(step)">
                                    <Icon Name="IconName.Edit"></Icon>
                                </button>
                            </Div>
                        </Div> </div>
                    }
                    <Row>
                        <Div Class="col-auto">

                            <button class="btn btn-primary btn-circle" @onclick="AddNewStep"><Icon Name="IconName.Add"></Icon></button>
                        </Div>

                    </Row>
                }
                </Div>

            </Column>
        </Row>
    </div>

    
    <Modal @ref="modalRef">
        <ModalContent Centered>
            <ModalHeader>
                <ModalTitle>Stap toevoegen</ModalTitle>
                <CloseButton />
            </ModalHeader>
            <ModalBody>
                <TextEdit @ref="EditNewStepTextBoxRef" @bind-Text="@NewEditStepText" />
            </ModalBody>
            <ModalFooter>
                <Button class="btn btn-link" Clicked="@HideModal">Cancel</Button>
                <Button Color="Color.Primary" Clicked="@HideAndSaveModal">Save</Button>
            </ModalFooter>
        </ModalContent>
    </Modal>

    
    <Modal @ref="addIngredientModalRef">
        <ModalContent Centered>
            <ModalHeader>
                <ModalTitle>Ingredienten toevoegen</ModalTitle>
                <CloseButton />
            </ModalHeader>
            <ModalBody>

                <BlazorPunterHomeApp.Components.SearchSelectProductComponent @ref="SearchProductControl" RecipeId="Recipedetails.Id" OnIngredientAdded="IngredientAddedHandler"></BlazorPunterHomeApp.Components.SearchSelectProductComponent>
            </ModalBody>
            <ModalFooter>
                <Button Color="Color.Primary" Clicked="@HideAddIngredientModal">Close</Button>
            </ModalFooter>
        </ModalContent>
    </Modal>

}